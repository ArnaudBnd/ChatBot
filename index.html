<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Super Chat temps réel !</title>
        <style>
            #zone_chat strong {
                color: white;
                background-color: black;
                padding: 2px;
            }
        </style>
    </head>
 
  <body>
    <h1>Le super Chat temps réel !</h1>
    <input type="text" class="input--send-message" placeholder="Votre message..." />
    <button class="btn--send-message">Envoyer</button>

    <section id="zone_chat"></section>

        <script src="/socket.io/socket.io.js"></script>

        <script>

            /**
              * ChatBot.io
              */
            var ChatBot = function ChatBot () {
              return this;
            };

            // Selection des id/class
            let zone_chat = document.querySelector('#zone_chat');
            let inputSendMessage = document.querySelector('.input--send-message');
            let btnSendMessage = document.querySelector('.btn--send-message');


            // Ajoute un message dans la page
            const insereMessage =  (pseudo, message) => {
              const p = document.createElement('p');

              p.textContent = pseudo + ' : ' + message ;
              zone_chat.appendChild(p);
            }

            let socket = io.connect('http://localhost:8081');
            let pseudo = prompt('Quel est votre pseudo ?');

            socket.emit('nouveau_client', pseudo);

            document.title = pseudo + ' - ' + document.title;

            // Quand on reçoit un message, on l'insère dans la page
            socket.on('message', (data) => {
              insereMessage(data.pseudo, data.message)
            })

            // Quand un nouveau client se connecte, on affiche l'information
            socket.on('nouveau_client', (pseudo) => {
              insereMessage(pseudo, ' a rejoint le Chat !');
            })

            /**
             * Run
             */
            ChatBot.prototype.run = function () {
            // Initialise
            /*this.renderContacts(this.entitys);
            this.loadBots(this.entitys);
            this.updateHeader(this.login);*/

            // Events
            this.sendValueKey();
            this.sendValue();

            return;
            };

            /**
             * Send Value from input say
             *
             * @return {Chat}
             */
            ChatBot.prototype.sendValue = function () {
            // Lorsqu'on envoie le formulaire, on transmet le message et on l'affiche sur la page
            btnSendMessage.addEventListener('click',() => {
                socket.emit('message', inputSendMessage.value); // Transmet le message aux autres sur le chat
                insereMessage(pseudo, inputSendMessage.value); // Affiche le message aussi sur 

                inputSendMessage.value = '';
                // notre page
                return false; // Permet de bloquer l'envoi "classique" du formulaire
            });

            return this;
            };

            /**
             * Send Value from keybord 'enter' say
             *
             * @return {Chat}
             */
            ChatBot.prototype.sendValueKey = function () {
            // Lorsqu'on envoie le formulaire, on transmet le message et on l'affiche sur la page
            inputSendMessage.addEventListener('keypress',(e) => {
            var key = e.which || e.keyCode;

            if (key === 13) {
                socket.emit('message', inputSendMessage.value); // Transmet le message aux autres sur le chat
                insereMessage(pseudo, inputSendMessage.value); // Affiche le message aussi sur 

                inputSendMessage.value = '';
                // notre page
                return false;
            } // Permet de bloquer l'envoi "classique" du formulaire
            });

            return this;
            };


            var chatBot = new ChatBot();

            chatBot.run();

        </script>

    </body>
</html>